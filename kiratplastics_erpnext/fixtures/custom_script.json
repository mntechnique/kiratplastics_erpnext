[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2016-06-06 17:47:34.476095", 
  "name": "Sales Invoice-Client", 
  "script": "frappe.ui.form.on(\"Sales Invoice Item\", \"rate\", function(frm, cdt, cdn) {\n   var sii = locals[cdt][cdn];\n   if ((frm.doc.kirat_invoice_type != \"Invoice for Sample\") && (frm.doc.kirat_invoice_type != \"Challan\")) {\n      if (sii.rate == 0.0) {\n        msgprint(\"Rate cannot be zero for invoices other than Sample and Challan.\");\n      }\n   }\n});\n\nfrappe.ui.form.on(\"Sales Invoice Item\", \"kirat_excise_price\", function(frm, cdt, cdn) {   \n  cur_frm.cscript.calculate_item_values();\n  refresh_field(\"items\"); //This updates excise duty amount in the dialog when the excise rate is changed.\n});\n\n//Toggle readonly for Customer and Chapter Head depending on whether items exist.\nfrappe.ui.form.on(\"Sales Invoice Item\", \"items_add\", function(frm, cdt, cdn) {\n   set_customer_readonly(frm);\n   set_chapter_head_readonly(frm);\n   set_invoice_type_and_series_readonly(frm);\n   set_excise_price_readonly(frm);\n});\n\nfrappe.ui.form.on(\"Sales Invoice Item\", \"items_remove\", function(frm) {\n   set_customer_readonly(frm);\n   set_chapter_head_readonly(frm);\n   set_invoice_type_and_series_readonly(frm);\n});\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {   \n   set_excise_chapter_filter(frm);\n   make_taxes_unsortable(frm);\n   set_item_filter_query(frm);\n   set_invoice_type_and_series_readonly(frm);\n   set_chapter_head_readonly(frm);\n   set_customer_readonly(frm);\n   //set_naming_series_and_price_list(frm);\n});\n\nfrappe.ui.form.on(\"Sales Invoice\", \"onload\", function(frm) {\n   make_taxes_unsortable(frm);\n   get_company_account(frm); //Load excise account from settings and keep in global var for 1.\n   get_zero_price_list(frm); //Load zero price list name from settings for 2\n   set_excise_price_readonly(frm);\n});\n\n// Add Excise Row to Taxes and Charges\nfrappe.ui.form.on(\"Sales Invoice\", \"validate\", function(frm) {\n   inject_excise_row_and_append_taxes(frm);\n});\n\nfrappe.ui.form.on(\"Sales Invoice\", \"kirat_invoice_type\", function(frm) {\n  set_naming_series_and_price_list(frm);\n});\n\nfrappe.ui.form.on(\"Sales Invoice\", \"kirat_excise_chapter_head\", function(frm) {\n  frappe.model.with_doc(\"Excise Chapter\", frm.doc.kirat_excise_chapter_head, function() { \n     var ec = frappe.model.get_doc(\"Excise Chapter\", frm.doc.kirat_excise_chapter_head);\n      frm.set_value(\"kirat_excise_chapter_name\", ec.excise_chapter_name);\n      frm.set_value(\"kirat_excise_chapter_rate\", ec.rate_of_duty);\n  });\n});\n\nfrappe.ui.form.on(\"Sales Invoice\", \"customer\", function(frm) {\n  frappe.model.with_doc(\"Customer\", frm.doc.customer, function() { \n     var cu = frappe.model.get_doc(\"Customer\", frm.doc.customer);\n      frm.set_value(\"kirat_cust_ecc_no\", cu.kirat_ecc_no);\n      frm.set_value(\"kirat_cust_cst_lst_no\", cu.kirat_cst_lst_no);\n      frm.set_value(\"kirat_cust_cst_lst_date\", cu.kirat_cst_lst_date);\n      //set_naming_series_and_price_list(frm);\n  });\n});\n\ncur_frm.cscript.customer = function() {\n  var me = this;\n  if(this.frm.updating_party_details) return;\n\n  erpnext.utils.get_party_details(this.frm,\n    \"erpnext.accounts.party.get_party_details\", {\n      posting_date: this.frm.doc.posting_date,\n      party: this.frm.doc.customer,\n      party_type: \"Customer\",\n      account: this.frm.doc.debit_to,\n      price_list: this.frm.doc.selling_price_list,\n    }, function() {\n    me.apply_pricing_rule();\n    set_naming_series_and_price_list(cur_frm);\n  })\n}\n\n//Replaces calculation of item value\ncur_frm.cscript.calculate_item_values = function() {    \n    var me = this;\n    if (!this.discount_amount_applied) {\n        $.each(this.frm.doc[\"items\"] || [], function(i, item) {\n            frappe.model.round_floats_in(item);\n            item.net_rate = item.rate;\n            item.amount = flt(item.rate * item.qty, precision(\"amount\", item));\n            item.net_amount = item.amount;\n            item.item_tax_amount = 0.0;\n            calculate_excise_duty_amount(item);\n            me.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n        });\n    }\n}\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Item", 
  "modified": "2016-06-01 18:23:13.084713", 
  "name": "Item-Client", 
  "script": "//cur_frm.add_fetch(\"excise_chapter\", \"rate_of_duty\", \"excise_duty_rate\");\n\nfrappe.ui.form.on(\"Item\", \"excise_chapter\", function(frm) {\n   if (!cur_frm.doc.excise_chapter) {\n      cur_frm.set_value(\"excise_duty_rate\", null);\n   } else {\n      frappe.model.with_doc(\"Excise Chapter\", cur_frm.doc.excise_chapter, function(frm){\n         var ec = frappe.model.get_doc(\"Excise Chapter\", cur_frm.doc.excise_chapter);\n         cur_frm.set_value(\"excise_duty_rate\", ec.rate_of_duty);\n      });\n   }\n});\n\nfrappe.ui.form.on(\"Item\", \"refresh\", function(frm) {\n    frm.set_query(\"excise_chapter\", function() {\n        return {\n            \"filters\": {\n                \"is_group\": \"No\"\n            }\n        };\n    });\n});", 
  "script_type": "Client"
 }
]