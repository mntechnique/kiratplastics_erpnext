[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2016-04-27 12:34:13.140872", 
  "name": "Sales Invoice-Client", 
  "script": "frappe.ui.form.on(\"Sales Invoice\", \"kirat_invoice_type\", function(frm) {\n  switch (frm.doc.kirat_invoice_type) {\n     case \"Supplementary Invoice\":\n        frm.set_value(\"naming_series\", \"SINV-SUP-\");\n        break;\n     case \"Invoice for Sample\":\n        frm.set_value(\"naming_series\", \"SINV-SMP-\");\n        break;\n     case \"Challan\":\n        frm.set_value(\"naming_series\", \"SINV-CHL-\");\n        break;\n     default:\n        frm.set_value(\"naming_series\", \"SINV-\");\n        break;\n  }\n});\n\n//Disable Invoice type selection in modify mode.\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\n    // use the __islocal value of doc, to check if the doc is saved or not\n    frm.set_df_property(\"kirat_invoice_type\", \"read_only\", frm.doc.__islocal ? 0 : 1);\n});\n\n//New item calculation\ncur_frm.cscript.calculate_item_values = function() {\n    var me = this;\n\n    if (!this.discount_amount_applied) {\n        $.each(this.frm.doc[\"items\"] || [], function(i, item) {\n            frappe.model.round_floats_in(item);\n            calculateAmtWithExcise(item);\n            me.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n        });\n    }\n}\n\nfunction calculateAmtWithExcise(itm) {\n   var itemPrice;\n   var itemPriceForExciseCalc;\n\n   if (itm.price_list_rate != 0) {\n      itemPrice = itm.price_list_rate;\n   } else {\n      itemPrice = itm.rate;\n   }\n\n   if (itm.kirat_excise_price != 0) {\n      itemPriceForExciseCalc = itm.kirat_excise_price;\n   } else {\n      itemPriceForExciseCalc = itemPrice; //Price list rate or rate.\n   }\n\n   var exciseDutyAmt = (itm.qty * itemPriceForExciseCalc) * (itm.kirat_excise_duty_rate / 100);\n   itm.kirat_excise_duty_amt = exciseDutyAmt;\n\n   var finalAmt = (itm.qty * itemPrice) + exciseDutyAmt;\n   \n   itm.amount = flt(finalAmt, precision(\"amount\", itm));\n\n   //msgprint(itm.amount);\n   //cur_frm.set_value(\"amount\", finalAmt);\n   //apparently the readonly field 'amount' also contains 0.92 instead of the final calculated amount.\n}\n\n//Filter items.\ncur_frm.set_query(\"item_code\", \"items\", function(doc, cdt, cdn) {\n   return {\n      query: \"kiratplastics_erpnext.kirat_plastics_erpnext.kp_api.kp_sinv_item_query\"\n   };\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Item", 
  "modified": "2016-04-22 18:41:11.151512", 
  "name": "Item-Client", 
  "script": "//cur_frm.add_fetch(\"excise_chapter\", \"rate_of_duty\", \"excise_duty_rate\");\n\nfrappe.ui.form.on(\"Item\", \"excise_chapter\", function(frm) {\n   if (!frm.doc.excise_chapter) {\n      frm.set_value(\"excise_duty_rate\", null);\n   } else {\n      frappe.model.with_doc(\"Excise Chapter\", frm.doc.excise_chapter, function(frm){\n         var ec = frappe.model.get_doc(\"Excise Chapter\", frm.doc.excise_chapter);\n         frm.set_value(\"excise_duty_rate\", ec.rate_of_duty);\n      });\n   }\n});\n\n", 
  "script_type": "Client"
 }
]