[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2016-04-28 16:35:34.780597", 
  "name": "Sales Invoice-Client", 
  "script": "frappe.ui.form.on(\"Sales Invoice\", \"kirat_invoice_type\", function(frm) {\n  switch (frm.doc.kirat_invoice_type) {\n     case \"Supplementary Invoice\":\n        frm.set_value(\"naming_series\", \"SINV-SUP-\");\n        break;\n     case \"Invoice for Sample\":\n        frm.set_value(\"naming_series\", \"SINV-SMP-\");\n        break;\n     case \"Challan\":\n        frm.set_value(\"naming_series\", \"SINV-CHL-\");\n        break;\n     default:\n        frm.set_value(\"naming_series\", \"SINV-\");\n        break;\n  }\n});\n\n//Disable Invoice type selection in modify mode.\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\n    // use the __islocal value of doc, to check if the doc is saved or not\n    frm.set_df_property(\"kirat_invoice_type\", \"read_only\", frm.doc.__islocal ? 0 : 1);\n});\n\n// Add Excise Row to Taxes and Charges\nfrappe.ui.form.on(\"Sales Invoice\", \"save\", function(frm) {\n    var items = frm.doc.items;\n    var total_ed = 0.0;\n    for (var i = 0; i <items.length; i++) {\n      total_ed += items[i].kirat_excise_duty_amt;\n    }\n    var ed = frm.add_child('taxes');\n    ed.charge_type = \"Actual\";\n    ed.description = \"Excise Duty Payable\";\n    ed.tax_amount = total_ed;\n});\n//New item calculation\n//Replace with new calculation of item value\ncur_frm.cscript.calculate_item_values = function() {\n    var me = this;\n\n    if (!this.discount_amount_applied) {\n        $.each(this.frm.doc[\"items\"] || [], function(i, item) {\n            frappe.model.round_floats_in(item);\n            calculate_excise_duty_amount(item);\n        });\n    }\n}\n\nfunction calculate_excise_duty_amount(item) {\n   var item_price;\n   var item_price_for_excise_calc;\n\n   if (item.price_list_rate != 0) {\n      item_price = item.price_list_rate;\n   } else {\n      item_price = item.rate;\n   }\n\n   if (item.kirat_excise_price != 0) {\n      item_price_for_excise_calc = item.kirat_excise_price;\n   } else {\n      item_price_for_excise_calc = itemPrice; //Price list rate or rate.\n   }\n\n   var excise_duty_amt = (item.qty * item_price_for_excise_calc) * (item.kirat_excise_duty_rate / 100);\n   item.kirat_excise_duty_amt = excise_duty_amt;\n}\n\n//Filter items.\ncur_frm.set_query(\"item_code\", \"items\", function(doc, cdt, cdn) {\n   return {\n      query: \"kiratplastics_erpnext.kirat_plastics_erpnext.kp_api.kp_sinv_item_query\"\n   };\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Item", 
  "modified": "2016-04-22 18:41:11.151512", 
  "name": "Item-Client", 
  "script": "//cur_frm.add_fetch(\"excise_chapter\", \"rate_of_duty\", \"excise_duty_rate\");\n\nfrappe.ui.form.on(\"Item\", \"excise_chapter\", function(frm) {\n   if (!frm.doc.excise_chapter) {\n      frm.set_value(\"excise_duty_rate\", null);\n   } else {\n      frappe.model.with_doc(\"Excise Chapter\", frm.doc.excise_chapter, function(frm){\n         var ec = frappe.model.get_doc(\"Excise Chapter\", frm.doc.excise_chapter);\n         frm.set_value(\"excise_duty_rate\", ec.rate_of_duty);\n      });\n   }\n});\n\n", 
  "script_type": "Client"
 }
]